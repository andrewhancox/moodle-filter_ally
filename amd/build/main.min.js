define("filter_ally/main",["exports","jquery","core/templates","core/str","filter_ally/ally","filter_ally/imagecover","filter_ally/util"],(function(_exports,_jquery,_templates,_str,_ally,_imagecover,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classPrivateMethodInitSpec(obj,privateSet){_checkPrivateRedeclaration(obj,privateSet),privateSet.add(obj)}function _classPrivateFieldInitSpec(obj,privateMap,value){_checkPrivateRedeclaration(obj,privateMap),privateMap.set(obj,value)}function _checkPrivateRedeclaration(obj,privateCollection){if(privateCollection.has(obj))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateFieldSet(receiver,privateMap,value){return function(receiver,descriptor,value){if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"set"),value),value}function _classPrivateMethodGet(receiver,privateSet,fn){if(!privateSet.has(receiver))throw new TypeError("attempted to get private field on non-instance");return fn}function _classPrivateFieldGet(receiver,privateMap){return function(receiver,descriptor){if(descriptor.get)return descriptor.get.call(receiver);return descriptor.value}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"get"))}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver))throw new TypeError("attempted to "+action+" private field on non-instance");return privateMap.get(receiver)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_ally=_interopRequireDefault(_ally),_imagecover=_interopRequireDefault(_imagecover),_util=_interopRequireDefault(_util);var _canViewFeedback=new WeakMap,_canDownload=new WeakMap,_courseId=new WeakMap,_initialised=new WeakMap,_params=new WeakMap,_getNodesByXpath=new WeakSet,_getNodeByXpath=new WeakSet,_renderTemplate=new WeakSet,_placeHoldSelector=new WeakSet,_placeHoldForumModule=new WeakSet,_placeHoldAssignModule=new WeakSet,_placeHoldFolderModule=new WeakSet,_placeHoldGlossaryModule=new WeakSet,_placeHoldLessonGeneral=new WeakSet,_placeHoldLessonPageContents=new WeakSet,_placeHoldLessonAnswersContent=new WeakSet,_placeHoldLessonResponsesContent=new WeakSet,_placeHoldLessonModule=new WeakSet,_placeHoldResourceModule=new WeakSet,_annotateSections=new WeakSet,_annotateModules=new WeakSet,_annotateSnapCourseSummary=new WeakSet,_annotateHtmlBlock=new WeakSet;function _getNodesByXpath2(xpath){const result=window.document.createExpression(xpath).evaluate(window.document,XPathResult.ANY_TYPE),nodes=[];let node;do{node=result.iterateNext(),nodes.push(node)}while(node);return nodes}function _getNodeByXpath2(xpath){return window.document.createExpression(xpath).evaluate(window.document,XPathResult.FIRST_ORDERED_NODE_TYPE).singleNodeValue}function _renderTemplate2(data,pathHash,targetEl){const dfd=_jquery.default.Deferred();return(0,_jquery.default)(targetEl).parents(".filter-ally-wrapper").length?(dfd.resolve(),dfd.promise()):(data.canviewfeedback=_classPrivateFieldGet(this,_canViewFeedback),data.candownload=_classPrivateFieldGet(this,_canDownload),data.html='<span id="content-target-'+pathHash+'"></span>',_templates.default.render("filter_ally/wrapper",data).done((result=>{0==(0,_jquery.default)(targetEl).next().find('span[data-file-id="'+pathHash+'"]').length&&((0,_jquery.default)(targetEl).after(result),(0,_jquery.default)("#content-target-"+pathHash).after(targetEl),(0,_jquery.default)("#content-target-"+pathHash).remove()),dfd.resolve()})),dfd.promise())}function _placeHoldSelector2(selector,map){const dfd=_jquery.default.Deferred(),length=(0,_jquery.default)(selector).length;let c=0;return length||dfd.resolve(),(0,_jquery.default)(selector).each(((idx,el)=>{const checkComplete=()=>{c===length&&dfd.resolve()};let url,type,regex;"a"===(0,_jquery.default)(el).prop("tagName").toLowerCase()?(url=(0,_jquery.default)(el).attr("href"),type="a"):(url=(0,_jquery.default)(el).attr("src"),type="img"),regex=url.indexOf("?")>-1?/pluginfile.php\/(\d*)\/(.*)(\?)/:/pluginfile.php\/(\d*)\/(.*)/;const match=url.match(regex);let pathHash;if(match){let path=match[1]+"/"+match[2];path=decodeURIComponent(path),pathHash=map[path]}if(void 0===pathHash){const query=_util.default.getQuery(url);if(query.file){regex=/\/(\d*)\/(.*)/;const match=decodeURIComponent(query.file).match(regex);if(match){let path=match[1]+"/"+match[2];path=decodeURIComponent(path),pathHash=map[path]}}}if(void 0===pathHash)return c++,void checkComplete();const data={isimage:"img"===type,fileid:pathHash,url:url};_classPrivateMethodGet(this,_renderTemplate,_renderTemplate2).call(this,data,pathHash,(0,_jquery.default)(el)).done((()=>{c++,checkComplete()}))})),dfd.promise()}function _placeHoldForumModule2(forumFileMapping){const dfd=_jquery.default.Deferred();return _classPrivateMethodGet(this,_placeHoldSelector,_placeHoldSelector2).call(this,'.forumpost .attachedimages img[src*="pluginfile.php"], .forumpost .body-content-container a[href*="pluginfile.php"]',forumFileMapping).done((()=>{dfd.resolve()})),dfd.promise()}function _placeHoldAssignModule2(assignFileMapping){const dfd=_jquery.default.Deferred();return _util.default.whenTrue((()=>(0,_jquery.default)('div[id*="assign_files_tree"] .ygtvitem').length>0),10).done((()=>{_classPrivateMethodGet(this,_placeHoldSelector,_placeHoldSelector2).call(this,'div[id*="assign_files_tree"] a[href*="pluginfile.php"]',assignFileMapping),dfd.resolve()})),dfd.promise()}function _placeHoldFolderModule2(folderFileMapping){const dfd=_jquery.default.Deferred();return _util.default.whenTrue((()=>(0,_jquery.default)(".foldertree > .filemanager .ygtvitem").length>0),10).done((()=>{_classPrivateMethodGet(this,_placeHoldSelector,_placeHoldSelector2).call(this,'.foldertree > .filemanager span:not(.filter-ally-wrapper) > a[href*="pluginfile.php"]',folderFileMapping).done((()=>{dfd.resolve()}))})),dfd.promise()}function _placeHoldGlossaryModule2(glossaryFileMapping){const dfd=_jquery.default.Deferred();(0,_jquery.default)(".entry .attachments > br").each(((idx,el)=>{const mainAnchor=(0,_jquery.default)(el).prev('a[href*="pluginfile.php"]');mainAnchor.addClass("ally-glossary-attachment");const iconAnchor=(0,_jquery.default)(mainAnchor).prev('a[href*="pluginfile.php"]');(0,_jquery.default)(el).after('<div class="ally-glossary-attachment-row"></div>');const container=(0,_jquery.default)(el).next(".ally-glossary-attachment-row");container.append(iconAnchor),container.append(mainAnchor),(0,_jquery.default)(el).remove()}));return _classPrivateMethodGet(this,_placeHoldSelector,_placeHoldSelector2).call(this,".entry .attachments .ally-glossary-attachment",glossaryFileMapping).done((()=>{dfd.resolve()})),dfd.promise()}function _placeHoldLessonGeneral2(map,selectorPrefix){const dfd=_jquery.default.Deferred();if(0===map.length)dfd.resolve();else for(let c in map){const path=this.urlEncodeFilePath(c),sel=selectorPrefix+'img[src*="'+path+'"], '+selectorPrefix+'a[href*="'+path+'"]';_classPrivateMethodGet(this,_placeHoldSelector,_placeHoldSelector2).call(this,sel,map).done((()=>{dfd.resolve()}))}return dfd.promise()}function _placeHoldLessonPageContents2(pageContentsMap){return _classPrivateMethodGet(this,_placeHoldLessonGeneral,_placeHoldLessonGeneral2).call(this,pageContentsMap,"")}function _placeHoldLessonAnswersContent2(pageAnswersMap){return _classPrivateMethodGet(this,_placeHoldLessonGeneral,_placeHoldLessonGeneral2).call(this,pageAnswersMap,".studentanswer table tr:nth-child(1) ")}function _placeHoldLessonResponsesContent2(pageResponsesMap){return _classPrivateMethodGet(this,_placeHoldLessonGeneral,_placeHoldLessonGeneral2).call(this,pageResponsesMap,".studentanswer table tr.lastrow ")}async function _placeHoldLessonModule2(lessonFileMapping){const pageContentsMap=lessonFileMapping.page_contents,pageAnswersMap=lessonFileMapping.page_answers,pageResponsesMap=lessonFileMapping.page_responses;await _classPrivateMethodGet(this,_placeHoldLessonPageContents,_placeHoldLessonPageContents2).call(this,pageContentsMap),await _classPrivateMethodGet(this,_placeHoldLessonAnswersContent,_placeHoldLessonAnswersContent2).call(this,pageAnswersMap),await _classPrivateMethodGet(this,_placeHoldLessonResponsesContent,_placeHoldLessonResponsesContent2).call(this,pageResponsesMap)}function _placeHoldResourceModule2(moduleFileMapping){const dfd=_jquery.default.Deferred();let c=0;const checkAllProcessed=()=>{c++,c>=Object.keys(moduleFileMapping).length&&dfd.resolve()};for(let moduleId in moduleFileMapping){const pathHash=moduleFileMapping[moduleId].content;let moduleEl;moduleEl=(0,_jquery.default)("body").hasClass("theme-snap")&&!(0,_jquery.default)("body").hasClass("format-tiles")?(0,_jquery.default)("#module-"+moduleId+":not(.snap-native) .activityinstance .snap-asset-link a:first-of-type:not(.clickable-region)"):(0,_jquery.default)("body").hasClass("format-tiles")?(0,_jquery.default)("#module-"+moduleId+" .activityinstance a:first-of-type:not(.clickable-region,.editing_move)"):(0,_jquery.default)("#module-"+moduleId+" .activity-instance a:first-of-type:not(.clickable-region,.editing_move)");if(moduleEl.find(".filter-ally-wrapper").length>0){checkAllProcessed();continue}const data={isimage:!1,fileid:pathHash,url:(0,_jquery.default)(moduleEl).attr("href")};_classPrivateMethodGet(this,_renderTemplate,_renderTemplate2).call(this,data,pathHash,moduleEl).done(checkAllProcessed)}return dfd.promise()}function _annotateSections2(sectionMapping){const dfd=_jquery.default.Deferred();for(let s in sectionMapping){const sectionId=sectionMapping[s],ident=this.buildContentIdent("course","course_sections","summary",sectionId),selectors=["#"+s+' > .content div[class*="summarytext"] .no-overflow',"body.theme-snap #"+s+" > .content > .summary > div > .no-overflow"];(0,_jquery.default)(selectors.join(",")).attr("data-ally-richcontent",ident)}return dfd.resolve(),dfd.promise()}function _annotateModules2(moduleMapping){const dfd=_jquery.default.Deferred();return void 0!==moduleMapping.mod_forum&&this.annotateForums(moduleMapping.mod_forum),void 0!==moduleMapping.mod_hsuforum&&this.annotateMRForums(moduleMapping.mod_hsuforum),void 0!==moduleMapping.mod_glossary&&this.annotateGlossary(moduleMapping.mod_glossary),void 0!==moduleMapping.mod_page&&this.annotatePage(moduleMapping.mod_page),void 0!==moduleMapping.mod_book&&this.annotateBook(moduleMapping.mod_book),void 0!==moduleMapping.mod_lesson&&this.annotateLesson(moduleMapping.mod_lesson),dfd.resolve(),dfd.promise()}function _annotateSnapCourseSummary2(mapping){const dfd=_jquery.default.Deferred(),snapFooterCourseSummary=(0,_jquery.default)("#snap-course-footer-summary > div.no-overflow");if(snapFooterCourseSummary.length){const ident=this.buildContentIdent("course","course","summary",mapping.courseId);snapFooterCourseSummary.attr("data-ally-richcontent",ident)}return dfd.resolve(),dfd.promise()}function _annotateHtmlBlock2(mapping){const dfd=_jquery.default.Deferred(),items=mapping.block_html;for(let i in items){const ident=items[i],selector=["#inst"+i+".block_html > .card-body > .card-text > .no-overflow","#inst"+i+".block_html > .content > .no-overflow"].join(",");(0,_jquery.default)(selector).attr("data-ally-richcontent",ident)}return dfd.resolve(),dfd.promise()}var _default=new class{constructor(){_classPrivateMethodInitSpec(this,_annotateHtmlBlock),_classPrivateMethodInitSpec(this,_annotateSnapCourseSummary),_classPrivateMethodInitSpec(this,_annotateModules),_classPrivateMethodInitSpec(this,_annotateSections),_classPrivateMethodInitSpec(this,_placeHoldResourceModule),_classPrivateMethodInitSpec(this,_placeHoldLessonModule),_classPrivateMethodInitSpec(this,_placeHoldLessonResponsesContent),_classPrivateMethodInitSpec(this,_placeHoldLessonAnswersContent),_classPrivateMethodInitSpec(this,_placeHoldLessonPageContents),_classPrivateMethodInitSpec(this,_placeHoldLessonGeneral),_classPrivateMethodInitSpec(this,_placeHoldGlossaryModule),_classPrivateMethodInitSpec(this,_placeHoldFolderModule),_classPrivateMethodInitSpec(this,_placeHoldAssignModule),_classPrivateMethodInitSpec(this,_placeHoldForumModule),_classPrivateMethodInitSpec(this,_placeHoldSelector),_classPrivateMethodInitSpec(this,_renderTemplate),_classPrivateMethodInitSpec(this,_getNodeByXpath),_classPrivateMethodInitSpec(this,_getNodesByXpath),_classPrivateFieldInitSpec(this,_canViewFeedback,{writable:!0,value:!1}),_classPrivateFieldInitSpec(this,_canDownload,{writable:!0,value:!1}),_classPrivateFieldInitSpec(this,_courseId,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_initialised,{writable:!0,value:!1}),_classPrivateFieldInitSpec(this,_params,{writable:!0,value:{}})}urlEncodeFilePath(filePath){const parts=filePath.split("/");for(let p in parts)parts[p]=encodeURIComponent(parts[p]);return parts.join("/")}buildContentIdent(component,table,field,id){return[component,table,field,id].join(":")}annotateModuleIntros(introMapping,module,additionalSelectors){for(let i in introMapping){const annotation=introMapping[i],selectors=["body.path-mod-"+module+".cmid-"+i+" #intro > .no-overflow","li.activity.modtype_"+module+"#module-"+i+" .description .no-overflow > .no-overflow","li.snap-activity.modtype_"+module+"#module-"+i+" .contentafterlink > .no-overflow"];if(additionalSelectors)for(let a in additionalSelectors)selectors.push(additionalSelectors[a].replace("{{i}}",i));(0,_jquery.default)(selectors.join(",")).attr("data-ally-richcontent",annotation)}}annotateForums(forumMapping){const intros=forumMapping.intros;this.annotateModuleIntros(intros,"forum");const discussions=forumMapping.posts;for(let d in discussions){const post="p"+d,annotation=discussions[d],selectors=["#page-mod-forum-discuss #"+post+" div.forumpost div.no-overflow"];(0,_jquery.default)(selectors.join(",")).attr("data-ally-richcontent",annotation)}}annotateMRForums(forumMapping){const intros=forumMapping.intros;this.annotateModuleIntros(intros,"hsuforum",["#hsuforum-header .hsuforum_introduction > .no-overflow"]);const discussions=forumMapping.posts;for(let d in discussions){const annotation=discussions[d],postSelector='article[id="p'+d+'"] div.posting';(0,_jquery.default)(postSelector).attr("data-ally-richcontent",annotation)}}annotateGlossary(mapping){const intros=mapping.intros;this.annotateModuleIntros(intros,"glossary");const entries=mapping.entries;for(let e in entries){const annotation=entries[e],entryFooter=(0,_jquery.default)('.entrylowersection .commands a[href*="id='+e+'"]'),entry=(0,_jquery.default)(entryFooter).parents(".glossarypost").find(".entry .no-overflow");(0,_jquery.default)(entry).attr("data-ally-richcontent",annotation)}}annotatePage(mapping){const intros=mapping.intros;this.annotateModuleIntros(intros,"page",["li.snap-native.modtype_page#module-{{i}} .contentafterlink > .summary-text"]);const content=mapping.content;for(let c in content){const annotation=content[c],selectors=["#page-mod-page-view #region-main .box.generalbox > .no-overflow","li.snap-native.modtype_page#module-"+c+" .pagemod-content"];(0,_jquery.default)(selectors.join(",")).attr("data-ally-richcontent",annotation)}}annotateBook(mapping){const intros=mapping.intros;this.annotateModuleIntros(intros,"book",["li.snap-native.modtype_book#module-{{i}} .contentafterlink > .summary-text .no-overflow"]);const content=mapping.chapters;let chapterId;if(_classPrivateFieldGet(this,_params).chapterid)chapterId=_classPrivateFieldGet(this,_params).chapterid;else{const urlParams=new URLSearchParams(window.location.search);chapterId=urlParams.get("chapterid")}_jquery.default.each(content,((ch,annotation)=>{if(chapterId!=ch)return;const selectors=["#page-mod-book-view #region-main .box.generalbox.book_content > .no-overflow","li.snap-native.modtype_page#module-"+ch+" .pagemod-content"];(0,_jquery.default)(selectors.join(",")).attr("data-ally-richcontent",annotation)}))}async annotateLesson(mapping){const intros=mapping.intros;this.annotateModuleIntros(intros,"lesson",["li.snap-native.modtype_lesson#module-{{i}} .contentafterlink > .summary-text .no-overflow"]);const content=mapping.lesson_pages;let pageId;for(let p in content)if("page-mod-lesson-edit"===document.body.id){const xpath='//a[@id="lesson-'+p+'"]//ancestor::table//tbody/tr/td/div[contains(@class, "no-overflow")]',annotation=content[p],node=_classPrivateMethodGet(this,_getNodeByXpath,_getNodeByXpath2).call(this,xpath);(0,_jquery.default)(node).attr("data-ally-richcontent",annotation)}else{const node=_classPrivateMethodGet(this,_getNodeByXpath,_getNodeByXpath2).call(this,'//form[contains(@action, "continue.php")]//input[@name="pageid"]');if(node)pageId=(0,_jquery.default)(node).val();else{pageId=new URLSearchParams(window.location.search).get("pageid")}if(pageId!=p)continue;const annotation=content[p],selectors=["#page-mod-lesson-view #region-main .box.contents > .no-overflow","#page-mod-lesson-view #region-main form > fieldset > .fcontainer > .contents .no-overflow","li.snap-native.modtype_page#module-"+p+" .pagemod-content"];(0,_jquery.default)(selectors.join(",")).attr("data-ally-richcontent",annotation)}const strings=await(0,_str.get_strings)([{key:"answer",component:"mod_lesson"},{key:"response",component:"mod_lesson"}]),answerLabel=strings[0],responseLabel=strings[1],answers=mapping.lesson_answers,processAnswerResponse=(pageId,i,label,annotation)=>{const xpath='//a[@id="lesson-'+pageId+'"]//ancestor::table//td/label[contains(text(),"'+label+" "+i+'")]/ancestor::tr/td[2]',nodes=_classPrivateMethodGet(this,_getNodesByXpath,_getNodesByXpath2).call(this,xpath);for(let n in nodes){const node=nodes[n];(0,_jquery.default)(node).attr("data-ally-richcontent",annotation)}};for(let a in answers){const annotation=answers[a],tmpArr=a.split("_"),pageId=tmpArr[0],ansId=tmpArr[1],anum=tmpArr[2];if("page-mod-lesson-edit"===document.body.id)processAnswerResponse(pageId,anum,answerLabel,annotation);else{if((0,_jquery.default)('#page-mod-lesson-view label[for="id_answerid_'+ansId+'"]').attr("data-ally-richcontent",annotation),_classPrivateFieldGet(this,_params).answerid&&_classPrivateFieldGet(this,_params).answerid==ansId)(0,_jquery.default)(".studentanswer tr:nth-of-type(1) > td div").attr("data-ally-richcontent",annotation);else{const answerWrapperId="answer_wrapper_"+ansId,answerEl=(0,_jquery.default)("#id_answerid_"+ansId);if(1!=answerEl.data("annotated")){const contentEls=answerEl.nextAll();answerEl.parent("label").append('<span id="answer_wrapper_'+ansId+'"></span>'),(0,_jquery.default)("#"+answerWrapperId).append(contentEls)}answerEl.data("annotated",1)}(0,_jquery.default)("#answer_wrapper_"+a).attr("data-ally-richcontent",annotation)}}const responses=mapping.lesson_answers_response;for(let r in responses){const annotation=responses[r],tmpArr=r.split("_"),pageId=tmpArr[0],respId=tmpArr[1],rnum=tmpArr[2];if("page-mod-lesson-edit"===document.body.id)processAnswerResponse(pageId,rnum,responseLabel,annotation);else if(_classPrivateFieldGet(this,_params).answerid&&_classPrivateFieldGet(this,_params).answerid==respId){const responseWrapperId="response_wrapper_"+respId;if(!(0,_jquery.default)(".studentanswer tr.lastrow > td #"+responseWrapperId).length){const contentEls=(0,_jquery.default)(".studentanswer tr.lastrow > td > br").nextAll();(0,_jquery.default)(".studentanswer tr.lastrow > td > br").after('<span id="'+responseWrapperId+'"></span>'),(0,_jquery.default)("#"+responseWrapperId).append(contentEls)}(0,_jquery.default)("#"+responseWrapperId).attr("data-ally-richcontent",annotation)}}}applyPlaceHolders(){M.util.js_pending("filter_ally_applyPlaceHolders");const dfd=_jquery.default.Deferred();if(void 0===ally_module_maps||void 0===ally_section_maps)return dfd.resolve(),dfd.promise();const self=this,tasks=[{mapVar:ally_module_maps.file_resources,method:_classPrivateMethodGet(this,_placeHoldResourceModule,_placeHoldResourceModule2)},{mapVar:ally_module_maps.assignment_files,method:_classPrivateMethodGet(this,_placeHoldAssignModule,_placeHoldAssignModule2)},{mapVar:ally_module_maps.folder_files,method:_classPrivateMethodGet(this,_placeHoldFolderModule,_placeHoldFolderModule2)},{mapVar:ally_module_maps.forum_files,method:_classPrivateMethodGet(this,_placeHoldForumModule,_placeHoldForumModule2)},{mapVar:ally_module_maps.glossary_files,method:_classPrivateMethodGet(this,_placeHoldGlossaryModule,_placeHoldGlossaryModule2)},{mapVar:ally_module_maps.lesson_files,method:_classPrivateMethodGet(this,_placeHoldLessonModule,_placeHoldLessonModule2)},{mapVar:ally_section_maps,method:_classPrivateMethodGet(this,_annotateSections,_annotateSections2)},{mapVar:ally_annotation_maps,method:_classPrivateMethodGet(this,_annotateModules,_annotateModules2)},{mapVar:{courseId:_classPrivateFieldGet(this,_courseId)},method:_classPrivateMethodGet(this,_annotateSnapCourseSummary,_annotateSnapCourseSummary2)},{mapVar:ally_annotation_maps,method:_classPrivateMethodGet(this,_annotateHtmlBlock,_annotateHtmlBlock2)}];return(0,_jquery.default)(document).ready((()=>{let completed=0;const onTaskComplete=()=>{completed++,completed===tasks.length&&(M.util.js_complete("filter_ally_applyPlaceHolders"),dfd.resolve())};for(let t in tasks){const task=tasks[t];Object.keys(task.mapVar).length>0?task.method.call(self,task.mapVar).done(onTaskComplete):onTaskComplete()}})),dfd.promise()}initStageTwo(jwt,config){if(_classPrivateFieldGet(this,_canViewFeedback)||_classPrivateFieldGet(this,_canDownload)){const debounceApplyPlaceHolders=_util.default.debounce((()=>this.applyPlaceHolders()),1e3);debounceApplyPlaceHolders().done((()=>{_imagecover.default.init(),_ally.default.init(jwt,config);try{const targetNode=(0,_jquery.default)(".foldertree > .filemanager")[0];if(targetNode){const observerConfig={attributes:!0,childList:!0,subtree:!0};new MutationObserver((mutationsList=>{mutationsList.filter((mutation=>"childList"===mutation.type)).forEach((()=>{_classPrivateMethodGet(this,_placeHoldFolderModule,_placeHoldFolderModule2).call(this,ally_module_maps.folder_files)}))})).observe(targetNode,observerConfig)}}catch(error){setInterval((()=>{_classPrivateMethodGet(this,_placeHoldFolderModule,_placeHoldFolderModule2).call(this,ally_module_maps.folder_files)}),5e3)}_classPrivateFieldSet(this,_initialised,!0)})),(0,_jquery.default)(document).ajaxComplete((()=>{_classPrivateFieldGet(this,_initialised)&&debounceApplyPlaceHolders()})),(0,_jquery.default)("body.theme-snap").length&&(0,_jquery.default)(document).ajaxComplete(((event,xhr,settings)=>{settings.url.includes("ally.js")&&(setTimeout((()=>{(0,_jquery.default)(".ally-feedback.ally-active.ally-score-indicator-embedded span").each(((idx,el)=>{"none"==el.style.display&&(el.style.display="block","ally-scoreindicator-container"==el.getAttribute("class")&&(el.style.display="inline-block",el.children[0].style.display="inline-block"))}))}),5e3),(0,_jquery.default)(document).off("ajaxComplete"))}))}}init(jwt,config,canViewFeedback,canDownload,courseId,params){_classPrivateFieldSet(this,_canViewFeedback,canViewFeedback),_classPrivateFieldSet(this,_canDownload,canDownload),_classPrivateFieldSet(this,_courseId,courseId),_classPrivateFieldSet(this,_params,params);const self=this,pluginJSURL=path=>M.cfg.wwwroot+"/pluginfile.php/"+M.cfg.contextid+"/filter_ally/"+path,polyfills={};if(document.evaluate||(polyfills["filter_ally/wgxpath"]=pluginJSURL("vendorjs/wgxpath.install")),"undefined"==typeof URLSearchParams&&(polyfills["filter_ally/urlsearchparams"]=["https://cdnjs.cloudflare.com/ajax/libs/url-search-params/1.1.0/url-search-params.amd.js",pluginJSURL("vendorjs/url-search-params.amd")]),polyfills==={})self.initStageTwo(jwt,config);else{require.config({enforceDefine:!1,paths:polyfills});const requires=Object.keys(polyfills);require(requires,(()=>{"undefined"==typeof URLSearchParams&&(window.URLSearchParams=arguments[1]),self.initStageTwo(jwt,config)}))}}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=main.min.js.map